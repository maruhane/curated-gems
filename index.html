<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title data-zh="羽的文选" data-en="FeatherJemila’s Picks" data-ja="はねのセレクション" data-ko="수우의 컬렉션">羽的文选</title>
    <link rel="stylesheet" href="./styles.css" />
    
    <style>
    /* 原有下拉菜单样式 */
    .lang-dropdown {
        position: relative;
        display: inline-block;
    }

    #lang-dropdown-toggle {
        background-color: #f0f0f0;
        color: #333;
        padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        min-width: 60px;
        text-align: center;
        user-select: none;
    }

    #lang-dropdown-content {
        display: none;
        position: absolute;
        background-color: white;
        min-width: 120px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.15);
        z-index: 1;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 5px;
        right: 0;
    }

    .lang-dropdown.show #lang-dropdown-content {
        display: block;
    }

    #lang-dropdown-content .lang-btn {
        color: black;
        padding: 10px 15px;
        text-decoration: none;
        display: block;
        width: 100%;
        text-align: left;
        border: none;
        background: none;
        cursor: pointer;
        font-size: 14px;
    }
    
    #lang-dropdown-content .lang-btn.active {
        font-weight: bold;
        background-color: #f0f0f0; 
    }

    #lang-dropdown-content .lang-btn:hover:not(.active) {
        background-color: #f9f9f9;
    }

    /* ===== 布局优化 ===== */
    .header-main {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 20px;
    }

    .logo-area {
        flex: 1 1 auto; /* 放宽弹性，允许换行 */
        min-width: 0;
        margin-right: 15px; /* 避免被右侧控件遮挡 */
    }

    .logo-area h1 {
        white-space: normal !important;
        word-break: break-word !important;
        line-height: 1.2;
        font-size: 2rem;
        margin: 0;
    }

    .logo-area .subtitle {
        display: block;
        white-space: normal !important;
        word-break: break-word !important;
        overflow: visible !important;
        line-height: 1.3;
        margin-top: 4px;
        font-size: 1rem;
    }

    .header-controls {
        flex-shrink: 0;
        display: flex;
        align-items: flex-start;
        gap: 8px; /* 缩小间距 */
    }

    .version-tabs button {
        padding: 4px 8px; /* 减小按钮占地 */
        font-size: 13px;
    }

    /* 日语标题和副标题微调 */
    html[lang="ja"] .logo-area h1 {
        font-size: 2rem;
        line-height: 1.2;
    }

    html[lang="ja"] .logo-area .subtitle {
        font-size: 1rem;
        line-height: 1.3;
        display: block;
        white-space: normal;
        word-break: break-word;
        overflow: visible;
    }

    </style>
</head>

<body>
    <header class="container">
        <div class="header-main">
            <div class="logo-area">
                <h1 data-zh="聚合好文" data-en="Good Reads Hub" data-ja="良文ピックアップ" data-ko="좋은 글 큐레이션">聚合好文</h1>
                <p class="subtitle" data-zh="精选世界的片刻" data-en="Curating Moments of the World" data-ja="世界のひとときをセレクト" data-ko="세상의 순간을 담다">精选世界的片刻</p>
            </div>
            <div class="header-controls">
                <div class="control-item lang-dropdown">
                    <button id="lang-dropdown-toggle">中</button>
                    <div id="lang-dropdown-content">
                        <button class="lang-btn" data-lang="zh" title="中文">中文</button>
                        <button class="lang-btn" data-lang="en" title="English">English</button>
                        <button class="lang-btn" data-lang="ja" title="日本語">日本語</button>
                        <button class="lang-btn" data-lang="ko" title="한국어">한국어</button>
                    </div>
                </div>
                <div class="control-item version-selector">
                    <div class="version-tabs">
                        <button class="version-tab" data-version="1" data-zh="基础版" data-en="Basic" data-ja="基本版" data-ko="기본판">基础版</button>
                        <button class="version-tab" data-version="2" data-zh="搜索版" data-en="Search" data-ja="検索版" data-ko="검색판">搜索版</button>
                        <button class="version-tab" data-version="3" data-zh="筛选版" data-en="Filter" data-ja="フィルター版" data-ko="필터판">筛选版</button>
                        <button class="version-tab" data-version="4" data-zh="动态版" data-en="Dynamic" data-ja="ダイナミック版" data-ko="다이나믹판">动态版</button>
                    </div>
                    <small id="hint" class="version-hint"
                        data-zh="当前：v1（地址可加 ?v=1/2/3/4 切换）"
                        data-en="Current: v1 (Add ?v=1/2/3/4 to URL to switch)"
                        data-ja="現在：v1（URLに ?v=1/2/3/4 を追加して切り替え）"
                        data-ko="현재: v1 (URL에 ?v=1/2/3/4 를 추가하여 전환)">当前：v1（地址可加 ?v=1/2/3/4 切换）</small>
                </div>
            </div>
        </div>
    </header>
    <main class="container">
        <div id="controls"></div>
        <div id="list" class="grid"></div>
        <p id="empty" class="hidden"
            data-zh="加载中…" data-en="Loading..." data-ja="読み込み中…" data-ko="로딩 중…">加载中…</p>
    </main>

    <script>
        // ---------- 初始化（无需修改） ----------
        let currentLang = 'zh';
        const params = new URLSearchParams(location.search);
        const ver = params.get("v") || "1";
        const langParam = (params.get("lang") || "zh").toLowerCase();
        const SUPPORTED = ['zh','en','ja','ko'];

        function updateLanguage(lang) {
            if (!SUPPORTED.includes(lang)) lang = 'zh';
            currentLang = lang;
            const langMap = { zh: 'zh-CN', en: 'en', ja: 'ja', ko: 'ko' };
            document.documentElement.lang = langMap[lang] || 'zh-CN';
            document.querySelectorAll('[data-zh],[data-en],[data-ja],[data-ko]').forEach(el => {
                const v = el.getAttribute(`data-${lang}`);
                if (v !== null) el.textContent = v;
            });
            document.querySelectorAll('option[data-zh],[option][data-en],[option][data-ja],[option][data-ko]').forEach(option=>{
                const v = option.getAttribute(`data-${lang}`);
                if (v !== null) option.textContent = v;
            });
            const currentVer = ver;
            const hintTexts = {
                zh: `当前：v${currentVer}（地址可加 ?v=1/2/3/4 切换）`,
                en: `Current: v${currentVer} (Add ?v=1/2/3/4 to URL to switch)`,
                ja: `現在：v${currentVer}（URLに ?v=1/2/3/4 を追加して切り替え）`,
                ko: `현재: v${currentVer} (URL에 ?v=1/2/3/4 를 추가하여 전환)`
            };
            const hintEl = document.getElementById('hint');
            if (hintEl) hintEl.textContent = hintTexts[lang] || hintTexts['zh'];
            
            document.querySelectorAll('.lang-btn').forEach(btn=>{
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            const toggleBtn = document.getElementById('lang-dropdown-toggle');
            if (toggleBtn) {
                const langTextMap = { zh: '中', en: 'EN', ja: '日本語', ko: '한국어' };
                toggleBtn.textContent = langTextMap[lang] || '中';
            }

            if (window.currentData && typeof window.renderWithLanguage === 'function') {
                window.renderWithLanguage(window.currentData, lang);
            }
        }

        updateLanguage(langParam);

        document.querySelectorAll('.lang-btn').forEach(btn=>{
            btn.addEventListener('click', () => {
                const newLang = btn.dataset.lang;
                if (!newLang || newLang === currentLang) return;
                document.querySelector('.lang-dropdown').classList.remove('show');
                if (typeof window.changeLang === 'function') {
                    window.changeLang(newLang);
                    updateLanguage(newLang);
                } else {
                    const u = new URL(location.href);
                    u.searchParams.set('lang', newLang);
                    u.searchParams.set('v', ver);
                    location.href = u.toString();
                }
            });
        });

        const versionTabs = document.querySelectorAll('.version-tab');
        versionTabs.forEach(tab => {
            if (tab.dataset.version === ver) tab.classList.add('active');
            tab.addEventListener('click', () => {
                const version = tab.dataset.version;
                const u = new URL(location.href);
                u.searchParams.set('v', version);
                u.searchParams.set('lang', currentLang);
                location.href = u.toString();
            });
        });
        
        const dropdownContainer = document.querySelector('.lang-dropdown');
        const toggleBtn = document.getElementById('lang-dropdown-toggle');

        if (toggleBtn && dropdownContainer) {
            toggleBtn.addEventListener('click', (event) => {
                event.stopPropagation();
                dropdownContainer.classList.toggle('show');
            });
            window.addEventListener('click', () => {
                if (dropdownContainer.classList.contains('show')) {
                    dropdownContainer.classList.remove('show');
                }
            });
        }

        (function loadVersionScript() {
            const s = document.createElement("script");
            s.src = `./v${ver}/app.js`;
            s.defer = true;
            document.body.appendChild(s);
        })();
    </script>
</body>

</html>
