<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title data-zh="孙玲的精选内容" data-en="Sunling's Curated Gems" data-ja="孫玲の厳選コンテンツ" data-ko="손령의 엄선된 콘텐츠">孙玲的精选内容</title>
    <link rel="stylesheet" href="./styles.css" />
    
    <style>
        .lang-dropdown {
            position: relative;
            display: inline-block;
        }

        #lang-dropdown-toggle {
            /* 这是您想要的圆形按钮样式 */
            background-color: #f0f0f0;
            color: #333;
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 20px; /* 圆角样式 */
            cursor: pointer;
            font-size: 14px;
            min-width: 60px;
            text-align: center;
            user-select: none; /* 防止点击时选中文本 */
        }

        #lang-dropdown-content {
            display: none; /* 默认隐藏 */
            position: absolute;
            background-color: white;
            min-width: 120px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.15);
            z-index: 1;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 5px;
            right: 0; /* 让菜单靠右对齐 */
        }

        /* 这个 'show' 类由 JS 添加，用于显示下拉菜单 */
        .lang-dropdown.show #lang-dropdown-content {
            display: block;
        }

        #lang-dropdown-content .lang-btn {
            color: black;
            padding: 10px 15px;
            text-decoration: none;
            display: block;
            width: 100%;
            text-align: left;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* 高亮当前选中的语言 */
        #lang-dropdown-content .lang-btn.active {
            font-weight: bold;
            background-color: #f0f0f0; 
        }

        /* 鼠标悬停在选项上时的效果 */
        #lang-dropdown-content .lang-btn:hover:not(.active) {
            background-color: #f9f9f9;
        }
    </style>
    </head>

<body>
    <header class="container">
        <div class="header-main">
            <div class="logo-area">
                <h1 data-zh="精选内容聚合" data-en="Curated Content Hub" data-ja="厳選コンテンツ集" data-ko="엄선된 콘텐츠 모음">精选内容聚合</h1>
                <p class="subtitle" data-zh="发现优质文章、播客和资源" data-en="Discover quality articles, podcasts and resources" data-ja="良質な記事・ポッドキャスト・リソースを発見" data-ko="우수한 기사, 팟캐스트 및 자료를 발견하세요">发现优质文章、播客和资源</p>
            </div>
            <div class="header-controls">
                
                <div class="control-item lang-dropdown">
                    <button id="lang-dropdown-toggle">中</button>
                    <div id="lang-dropdown-content">
                        <button class="lang-btn" data-lang="zh" title="中文">中文</button>
                        <button class="lang-btn" data-lang="en" title="English">English</button>
                        <button class="lang-btn" data-lang="ja" title="日本語">日本語</button>
                        <button class="lang-btn" data-lang="ko" title="한국어">한국어</button>
                    </div>
                </div>
                <div class="control-item version-selector">
                    <div class="version-tabs">
                        <button class="version-tab" data-version="1" data-zh="基础版" data-en="Basic" data-ja="基本版" data-ko="기본판">基础版</button>
                        <button class="version-tab" data-version="2" data-zh="搜索版" data-en="Search" data-ja="検索版" data-ko="검색판">搜索版</button>
                        <button class="version-tab" data-version="3" data-zh="筛选版" data-en="Filter" data-ja="フィルター版" data-ko="필터판">筛选版</button>
                        <button class="version-tab" data-version="4" data-zh="动态版" data-en="Dynamic" data-ja="ダイナミック版" data-ko="다이나믹판">动态版</button>
                    </div>
                    <small id="hint" class="version-hint"
                        data-zh="当前：v1（地址可加 ?v=1/2/3/4 切换）"
                        data-en="Current: v1 (Add ?v=1/2/3/4 to URL to switch)"
                        data-ja="現在：v1（URLに ?v=1/2/3/4 を追加して切り替え）"
                        data-ko="현재: v1 (URL에 ?v=1/2/3/4 를 추가하여 전환)">当前：v1（地址可加 ?v=1/2/3/4 切换）</small>
                </div>
            </div>
        </div>
    </header>
    <main class="container">
        <div id="controls"></div>
        <div id="list" class="grid"></div>
        <p id="empty" class="hidden"
            data-zh="加载中…" data-en="Loading..." data-ja="読み込み中…" data-ko="로딩 중…">加载中…</p>
    </main>

    <script>
        // ---------- 初始化（无需修改） ----------
        let currentLang = 'zh';
        const params = new URLSearchParams(location.search);
        const ver = params.get("v") || "1";
        const langParam = (params.get("lang") || "zh").toLowerCase();
        const SUPPORTED = ['zh','en','ja','ko'];

        function updateLanguage(lang) {
            if (!SUPPORTED.includes(lang)) lang = 'zh';
            currentLang = lang;
            const langMap = { zh: 'zh-CN', en: 'en', ja: 'ja', ko: 'ko' };
            document.documentElement.lang = langMap[lang] || 'zh-CN';
            document.querySelectorAll('[data-zh],[data-en],[data-ja],[data-ko]').forEach(el => {
                const v = el.getAttribute(`data-${lang}`);
                if (v !== null) el.textContent = v;
            });
            document.querySelectorAll('option[data-zh],[option][data-en],[option][data-ja],[option][data-ko]').forEach(option=>{
                const v = option.getAttribute(`data-${lang}`);
                if (v !== null) option.textContent = v;
            });
            const currentVer = ver;
            const hintTexts = {
                zh: `当前：v${currentVer}（地址可加 ?v=1/2/3/4 切换）`,
                en: `Current: v${currentVer} (Add ?v=1/2/3/4 to URL to switch)`,
                ja: `現在：v${currentVer}（URLに ?v=1/2/3/4 を追加して切り替え）`,
                ko: `현재: v${currentVer} (URL에 ?v=1/2/3/4 를 추가하여 전환)`
            };
            const hintEl = document.getElementById('hint');
            if (hintEl) hintEl.textContent = hintTexts[lang] || hintTexts['zh'];
            
            // 更新语言按钮高亮
            document.querySelectorAll('.lang-btn').forEach(btn=>{
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            // === 新增：更新下拉菜单主按钮的文本 ===
            const toggleBtn = document.getElementById('lang-dropdown-toggle');
            if (toggleBtn) {
                const langTextMap = { zh: '中', en: 'EN', ja: '日本語', ko: '한국어' };
                toggleBtn.textContent = langTextMap[lang] || '中';
            }
            // === 新增结束 ===

            if (window.currentData && typeof window.renderWithLanguage === 'function') {
                window.renderWithLanguage(window.currentData, lang);
            }
        }

        updateLanguage(langParam);

        document.querySelectorAll('.lang-btn').forEach(btn=>{
            btn.addEventListener('click', () => {
                const newLang = btn.dataset.lang;
                if (!newLang || newLang === currentLang) return;

                // === 新增：选择后关闭下拉菜单 ===
                document.querySelector('.lang-dropdown').classList.remove('show');

                if (typeof window.changeLang === 'function') {
                    window.changeLang(newLang);
                    updateLanguage(newLang);
                } else {
                    const u = new URL(location.href);
                    u.searchParams.set('lang', newLang);
                    u.searchParams.set('v', ver);
                    location.href = u.toString();
                }
            });
        });

        const versionTabs = document.querySelectorAll('.version-tab');
        versionTabs.forEach(tab => {
            if (tab.dataset.version === ver) tab.classList.add('active');
            tab.addEventListener('click', () => {
                const version = tab.dataset.version;
                const u = new URL(location.href);
                u.searchParams.set('v', version);
                u.searchParams.set('lang', currentLang);
                location.href = u.toString();
            });
        });
        
        // === 新增：下拉菜单的开关逻辑 ===
        const dropdownContainer = document.querySelector('.lang-dropdown');
        const toggleBtn = document.getElementById('lang-dropdown-toggle');

        if (toggleBtn && dropdownContainer) {
            toggleBtn.addEventListener('click', (event) => {
                // 阻止事件冒泡，防止触发下面的 window 点击事件
                event.stopPropagation();
                dropdownContainer.classList.toggle('show');
            });
            // 当点击页面其他地方时，关闭下拉菜单
            window.addEventListener('click', () => {
                if (dropdownContainer.classList.contains('show')) {
                    dropdownContainer.classList.remove('show');
                }
            });
        }
        // === 新增结束 ===

        (function loadVersionScript() {
            const s = document.createElement("script");
            s.src = `./v${ver}/app.js`;
            s.defer = true;
            document.body.appendChild(s);
        })();
    </script>
</body>

</html>
