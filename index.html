<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title data-zh="羽的文选" data-en="Jemila’s Picks" data-ja="羽のセレクション" data-ko="수우의 컬렉션">羽的文选</title>
    <link rel="stylesheet" href="./styles.css" />
    
   <style>
/* ============= 下拉菜单样式（保留原样） ============= */
.lang-dropdown {
    position: relative;
    display: inline-block;
}

#lang-dropdown-toggle {
    background-color: #f0f0f0;
    color: #333;
    padding: 8px 16px;
    border: 1px solid #ddd;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    min-width: 60px;
    text-align: center;
    user-select: none;
}

#lang-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 120px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.15);
    z-index: 1;
    border-radius: 8px;
    overflow: hidden;
    margin-top: 5px;
    right: 0;
}

.lang-dropdown.show #lang-dropdown-content {
    display: block;
}

#lang-dropdown-content .lang-btn {
    color: black;
    padding: 10px 15px;
    text-decoration: none;
    display: block;
    width: 100%;
    text-align: left;
    border: none;
    background: none;
    cursor: pointer;
    font-size: 14px;
}

#lang-dropdown-content .lang-btn.active {
    font-weight: bold;
    background-color: #f0f0f0;
}

#lang-dropdown-content .lang-btn:hover:not(.active) {
    background-color: #f9f9f9;
}

/* ============= 核心布局（统一横排，并尽量不改字号） ============= */

/* 确保 header 一行内左右对齐，不换行（关键） */
.header-main {
    display: flex;
    justify-content: space-between;
    align-items: center;   /* 垂直居中，避免控件被推到下一行 */
    gap: 20px;
    flex-wrap: nowrap;     /* 禁止换行，保持标题与右侧控件在同一行 */
}

/* 左侧标题区域：竖直堆叠标题 + 副标题，允许内部换行，且不在此处改变 font-size */
.logo-area {
    flex: 1 1 auto; /* 允许伸缩，占据剩余空间 */
    min-width: 0;   /* 允许内部文字换行而不撑破布局 */
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

/* 标题：强制横排（覆盖可能残留的竖排规则），但不要设置 font-size */
.logo-area h1 {
    writing-mode: horizontal-tb !important; /* 确保所有语言横排 */
    white-space: normal !important;         /* 默认允许换行（日语单独处理） */
    word-break: break-word;
    margin: 0;
    line-height: 1.1;
    /* 注意：刻意不设置 font-size，以免影响各语言已有的显示大小 */
}

/* 副标题：保持正常换行和继承字号 */
.logo-area .subtitle {
    margin: 6px 0 0 0;
    white-space: normal !important;
    word-break: break-word;
}

/* 右侧控件保持固定布局，不收缩，避免被挤下去 */
.header-controls {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-shrink: 0; /* 不允许右侧收缩到下一行 */
    padding-top: 0;
}

/* ============= 日语专用：单行保护（避免被拆成两行），但不改字号 ============= */
/* 仅在 html[lang="ja"] 时启用：让标题与副标题保持单行，超出显示省略号 */
html[lang="ja"] .logo-area h1,
html[lang="ja"] .logo-area .subtitle {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis; /* 超长用省略号，不会把右侧控件推到下一行 */
}

/* ============= 小屏幕友好：当屏幕窄时改为堆叠（避免字体被挤压） ============= */
@media (max-width: 760px) {
    .header-main {
        flex-direction: column;
        align-items: flex-start;
    }
    .header-controls {
        width: 100%;
        margin-top: 10px;
        justify-content: flex-start;
    }
}

/* ============= 兼容补充（防止其他规则影响标题大小或写排） ============= */
/* 如果页面某处有强规则设置全局 writing-mode 或 font-size，优先保证 h1 恢复默认横排与继承字号 */
.logo-area h1,
.logo-area .subtitle {
    /* 不覆写字体族或字号，保持站点主样式的控制权 */
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
}

/* 结束 */
    </style>

<body>
    <header class="container">
        <div class="header-main">
            <div class="logo-area">
                <h1 data-zh="聚合好文" data-en="Good Reads Hub" data-ja="良文ピックアップ" data-ko="좋은 글 큐레이션">聚合好文</h1>
                <p class="subtitle" data-zh="精选世界的片刻" data-en="Curating Moments of the World" data-ja="世界のひとときをセレクト" data-ko="세상의 순간을 담다">精选世界的片刻</p>
            </div>
            <div class="header-controls">
                
                <div class="control-item lang-dropdown">
                    <button id="lang-dropdown-toggle">中</button>
                    <div id="lang-dropdown-content">
                        <button class="lang-btn" data-lang="zh" title="中文">中文</button>
                        <button class="lang-btn" data-lang="en" title="English">English</button>
                        <button class="lang-btn" data-lang="ja" title="日本語">日本語</button>
                        <button class="lang-btn" data-lang="ko" title="한국어">한국어</button>
                    </div>
                </div>
                <div class="control-item version-selector">
                    <div class="version-tabs">
                        <button class="version-tab" data-version="1" data-zh="基础版" data-en="Basic" data-ja="基本版" data-ko="기본판">基础版</button>
                        <button class="version-tab" data-version="2" data-zh="搜索版" data-en="Search" data-ja="検索版" data-ko="검색판">搜索版</button>
                        <button class="version-tab" data-version="3" data-zh="筛选版" data-en="Filter" data-ja="フィルター版" data-ko="필터판">筛选版</button>
                        <button class="version-tab" data-version="4" data-zh="动态版" data-en="Dynamic" data-ja="ダイナミック版" data-ko="다이나믹판">动态版</button>
                    </div>
                    <small id="hint" class="version-hint"
                        data-zh="当前：v1（地址可加 ?v=1/2/3/4 切换）"
                        data-en="Current: v1 (Add ?v=1/2/3/4 to URL to switch)"
                        data-ja="現在：v1（URLに ?v=1/2/3/4 を追加して切り替え）"
                        data-ko="현재: v1 (URL에 ?v=1/2/3/4 를 추가하여 전환)">当前：v1（地址可加 ?v=1/2/3/4 切换）</small>
                </div>
            </div>
        </div>
    </header>
    <main class="container">
        <div id="controls"></div>
        <div id="list" class="grid"></div>
        <p id="empty" class="hidden"
            data-zh="加载中…" data-en="Loading..." data-ja="読み込み中…" data-ko="로딩 중…">加载中…</p>
    </main>

    <script>
        // ---------- 初始化（无需修改） ----------
        let currentLang = 'zh';
        const params = new URLSearchParams(location.search);
        const ver = params.get("v") || "1";
        const langParam = (params.get("lang") || "zh").toLowerCase();
        const SUPPORTED = ['zh','en','ja','ko'];

        function updateLanguage(lang) {
            if (!SUPPORTED.includes(lang)) lang = 'zh';
            currentLang = lang;
            const langMap = { zh: 'zh-CN', en: 'en', ja: 'ja', ko: 'ko' };
            document.documentElement.lang = langMap[lang] || 'zh-CN';
            document.querySelectorAll('[data-zh],[data-en],[data-ja],[data-ko]').forEach(el => {
                const v = el.getAttribute(`data-${lang}`);
                if (v !== null) el.textContent = v;
            });
            document.querySelectorAll('option[data-zh],[option][data-en],[option][data-ja],[option][data-ko]').forEach(option=>{
                const v = option.getAttribute(`data-${lang}`);
                if (v !== null) option.textContent = v;
            });
            const currentVer = ver;
            const hintTexts = {
                zh: `当前：v${currentVer}（地址可加 ?v=1/2/3/4 切换）`,
                en: `Current: v${currentVer} (Add ?v=1/2/3/4 to URL to switch)`,
                ja: `現在：v${currentVer}（URLに ?v=1/2/3/4 を追加して切り替え）`,
                ko: `현재: v${currentVer} (URL에 ?v=1/2/3/4 를 추가하여 전환)`
            };
            const hintEl = document.getElementById('hint');
            if (hintEl) hintEl.textContent = hintTexts[lang] || hintTexts['zh'];
            
            // 更新语言按钮高亮
            document.querySelectorAll('.lang-btn').forEach(btn=>{
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            // === 新增：更新下拉菜单主按钮的文本 ===
            const toggleBtn = document.getElementById('lang-dropdown-toggle');
            if (toggleBtn) {
                const langTextMap = { zh: '中', en: 'EN', ja: '日本語', ko: '한국어' };
                toggleBtn.textContent = langTextMap[lang] || '中';
            }
            // === 新增结束 ===

            if (window.currentData && typeof window.renderWithLanguage === 'function') {
                window.renderWithLanguage(window.currentData, lang);
            }
        }

        updateLanguage(langParam);

        document.querySelectorAll('.lang-btn').forEach(btn=>{
            btn.addEventListener('click', () => {
                const newLang = btn.dataset.lang;
                if (!newLang || newLang === currentLang) return;

                // === 新增：选择后关闭下拉菜单 ===
                document.querySelector('.lang-dropdown').classList.remove('show');

                if (typeof window.changeLang === 'function') {
                    window.changeLang(newLang);
                    updateLanguage(newLang);
                } else {
                    const u = new URL(location.href);
                    u.searchParams.set('lang', newLang);
                    u.searchParams.set('v', ver);
                    location.href = u.toString();
                }
            });
        });

        const versionTabs = document.querySelectorAll('.version-tab');
        versionTabs.forEach(tab => {
            if (tab.dataset.version === ver) tab.classList.add('active');
            tab.addEventListener('click', () => {
                const version = tab.dataset.version;
                const u = new URL(location.href);
                u.searchParams.set('v', version);
                u.searchParams.set('lang', currentLang);
                location.href = u.toString();
            });
        });
        
        // === 新增：下拉菜单的开关逻辑 ===
        const dropdownContainer = document.querySelector('.lang-dropdown');
        const toggleBtn = document.getElementById('lang-dropdown-toggle');

        if (toggleBtn && dropdownContainer) {
            toggleBtn.addEventListener('click', (event) => {
                // 阻止事件冒泡，防止触发下面的 window 点击事件
                event.stopPropagation();
                dropdownContainer.classList.toggle('show');
            });
            // 当点击页面其他地方时，关闭下拉菜单
            window.addEventListener('click', () => {
                if (dropdownContainer.classList.contains('show')) {
                    dropdownContainer.classList.remove('show');
                }
            });
        }
        // === 新增结束 ===

        (function loadVersionScript() {
            const s = document.createElement("script");
            s.src = `./v${ver}/app.js`;
            s.defer = true;
            document.body.appendChild(s);
        })();
    </script>
</body>

</html>
